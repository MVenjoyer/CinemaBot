# cinemabot

cinemabot — это телеграм-бот для поиска информации о фильмах, предоставления бесплатных ссылок для просмотра и ведения статистики запросов пользователей.

## Команды бота

### 1. `/start` или `/help`
- **Описание:** Показывает список доступных команд и функционал бота.
- **Ответ:**
    ```
    Вот всё что я умею:
    /help - чтобы узнать что я умею
    /history - история последних 10-ти запросов
    /stats - сколько раз пользователь спрашивал про каждый фильм
    Для получения доступа к бесплатному просмотру фильма, введите его название.
    ```

### 2. `/history`
- **Описание:** Показывает историю последних 10 запросов пользователя.
- **Как работает:**
  - Получает данные из базы данных, связанных с идентификатором пользователя.
  - Возвращает список запросов с указанием времени и названия фильма.

### 3. `/stats`
- **Описание:** Показывает статистику запросов пользователя.
- **Как работает:**
  - Подсчитывает количество запросов для каждого фильма из базы данных.
  - Возвращает список фильмов с количеством запросов к ним.

### 4. Поиск фильма по названию (без команды)
- **Описание:** Бот ищет фильм по введённому названию и возвращает информацию о нём с ссылками на бесплатный просмотр.
- **Как работает:**
  1. Использует API Кинопоиска для поиска фильма.
  2. Парсит данные с описанием, жанрами и постером фильма.
  3. Генерирует ссылки для просмотра с сайтов (например, Lordfilm, Rutube) через Bing.
  4. Отправляет информацию о фильме с кнопками для перехода на доступные ресурсы.

## Описание внутренней логики

### Поиск фильма через API
Функция `__get_film_by_name` отправляет запрос к API Кинопоиска, используя введённое название фильма. Результаты обрабатываются и извлекаются данные о фильме (название, год, описание, жанры и постер).

### Генерация ссылок
Функция `__find_link` ищет рабочие ссылки через Google. Она проверяет первые несколько ссылок и фильтрует их по заданному ресурсу (например, Lordfilm).

### Создание кнопок
Функция `__create_inline_keyboard` создаёт клавиатуру с кнопками для перехода по найденным ссылкам.

### Хранение истории и статистики
База данных используется для:
- Сохранения запросов пользователей.
- Хранения информации о количестве запросов для каждого фильма.

## Логирование
Все ошибки и ключевые события записываются в лог с использованием модуля `logging`. Уровень логирования можно настроить через `logging.basicConfig`.

## Полезные ссылки:
Пример рабочего бота в телеграмме: @MVenjoyerCinemaBot 

ps. Бот развёрнут в контейнере, так что может иногда не работать.
